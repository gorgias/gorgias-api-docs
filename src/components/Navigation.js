import React from 'react'
import slug from 'slug'
import {fromJS} from 'immutable'

const Navigation = () => {
    const openapi = window.openapi
    const paths = openapi.get('paths')
    const orderedTags = openapi.get('tags').sort((v1, v2) => v1.get('name') > v2.get('name'))
    const orderedDefinitions = openapi.get('definitions').sortBy((v, k) => k)
    const orderedResources = orderedTags.map((tag) => {
        const subResources = []
        paths.forEach((verbs, path) => {
            if (!verbs.isEmpty()) {
                verbs.forEach((verb, method) => {
                    if (verb.get('tags').contains(tag.get('name'))) {
                        subResources.push({
                            name: verb.get('summary'),
                            title: verb.get('description'),
                            method,
                            path,
                        })
                    }
                })
            }
        })
        return tag.set('subResources', fromJS(subResources))
    })

    return (
        <div className="navigation">
            <div className="navigation-wrap">
                <div id="navbar-example3" className="navbar">
                    <a href="/" className="brand">
                        <svg id="logo" viewBox="0 0 115 27" xmlns="http://www.w3.org/2000/svg">
                            <g fill="#141D67">
                                <path
                                    d="M13.776 4.785V6.38l-2.424.414c.237.296.414.65.532 1.064.12.413.237.886.237 1.358 0 1.418-.47 2.54-1.476 3.368-1.005.827-2.365 1.24-4.14 1.24-.472 0-.886-.058-1.24-.117-.65.413-.947.827-.947 1.358 0 .296.178.532.473.71.295.177.827.236 1.655.236H8.87c1.536 0 2.896.297 3.724.947.828.65 1.182 1.595 1.182 2.836 0 1.595-.65 2.777-1.95 3.663-1.302.827-3.37 1.3-5.854 1.3-1.892 0-3.37-.355-4.376-1.005C.532 23.22 0 22.274 0 21.034c0-.827.296-1.595.828-2.186.532-.59 1.3-1.005 2.306-1.24-.414-.178-.71-.415-1.005-.828-.24-.357-.416-.77-.416-1.184 0-.53.177-.945.473-1.3.295-.354.768-.71 1.36-1.063-.71-.295-1.3-.827-1.774-1.536-.473-.71-.71-1.536-.71-2.482 0-1.536.473-2.658 1.42-3.485.945-.825 2.364-1.24 4.137-1.24.414 0 .828 0 1.242.06.473.117.768.176 1.005.235h4.906zM2.66 20.855c0 .65.296 1.123.888 1.477.59.355 1.42.532 2.483.532 1.657 0 2.84-.236 3.668-.71.827-.47 1.182-1.062 1.182-1.83 0-.59-.237-1.064-.65-1.3-.415-.236-1.243-.355-2.425-.355H5.5c-.888 0-1.54.176-2.07.59-.474.354-.77.885-.77 1.594zm1.3-11.58c0 .887.238 1.537.71 2.01.474.472 1.124.708 1.952.708 1.715 0 2.602-.886 2.602-2.717 0-.887-.237-1.596-.65-2.068-.415-.473-1.065-.71-1.952-.71s-1.537.237-1.95.71c-.474.413-.71 1.122-.71 2.068zM34.17 11.82c0 2.245-.53 3.958-1.596 5.258-1.064 1.24-2.6 1.89-4.493 1.89-1.18 0-2.245-.295-3.19-.886-.888-.59-1.597-1.418-2.13-2.48-.473-1.066-.71-2.306-.71-3.724 0-2.246.532-3.96 1.596-5.2C24.71 5.38 26.248 4.73 28.14 4.73s3.37.65 4.434 1.89c1.065 1.3 1.597 3.014 1.597 5.2zm-10.82 0c0 1.89.415 3.367 1.242 4.372.828 1.063 2.01 1.595 3.49 1.595 1.477 0 2.66-.532 3.487-1.595.826-1.064 1.24-2.54 1.24-4.372 0-1.89-.414-3.368-1.24-4.372-.83-1.064-2.01-1.536-3.55-1.536-1.538 0-2.66.53-3.49 1.536-.767 1.004-1.18 2.48-1.18 4.372zM43.34 4.73c.592 0 1.183.06 1.893.177l-.238 1.183c-.59-.12-1.183-.237-1.774-.237-1.18 0-2.127.472-2.896 1.477-.77 1.004-1.123 2.245-1.123 3.722v7.562h-1.24V5.024h1.064l.12 2.483h.058c.59-1.005 1.182-1.714 1.773-2.127.71-.414 1.48-.65 2.365-.65zM58.655 5.025v.887l-2.838.177c.768.943 1.123 1.95 1.123 3.07 0 1.3-.414 2.363-1.3 3.19-.888.83-2.07 1.24-3.548 1.24-.65 0-1.065 0-1.3-.06-.474.238-.888.593-1.124.947-.237.355-.414.71-.414 1.123 0 .415.177.77.473.946.354.177.887.296 1.655.296h2.365c1.478 0 2.602.295 3.43.886.768.59 1.182 1.477 1.182 2.66 0 1.416-.593 2.54-1.776 3.366-1.182.768-2.838 1.182-5.025 1.182-1.716 0-3.076-.355-4.02-1.005-.948-.65-1.42-1.593-1.42-2.775 0-.945.296-1.713.887-2.363.59-.65 1.36-1.062 2.365-1.3-.414-.176-.77-.412-1.005-.767-.237-.295-.355-.71-.355-1.122 0-.885.59-1.712 1.774-2.42-.71-.297-1.3-.77-1.774-1.478-.473-.71-.65-1.477-.65-2.423 0-1.36.414-2.482 1.3-3.31.888-.827 2.07-1.242 3.548-1.242.887 0 1.596.06 2.07.236h4.375v.06zm-11.057 16.01c0 1.892 1.42 2.837 4.198 2.837 3.607 0 5.38-1.122 5.38-3.426 0-.828-.295-1.418-.827-1.773-.593-.354-1.48-.532-2.72-.532h-2.25c-2.542-.116-3.784.89-3.784 2.897zM48.603 9.28c0 1.063.296 1.89.946 2.48.65.59 1.476.887 2.6.887 1.123 0 2.01-.296 2.6-.886.593-.59.888-1.416.888-2.54 0-1.18-.296-2.067-.947-2.6-.65-.59-1.477-.885-2.6-.885-1.065 0-1.95.296-2.602.946-.532.59-.887 1.478-.887 2.6zM61.31 1.182c0-.828.237-1.182.77-1.182.235 0 .472.118.59.295.118.237.236.532.236.887 0 .354-.06.65-.236.886-.118.236-.355.354-.59.354-.533 0-.77-.413-.77-1.24zm1.42 17.488h-1.244V5.022h1.244V18.67zM75.62 18.674l-.295-2.186h-.118c-.71.886-1.42 1.477-2.128 1.89-.71.355-1.6.532-2.604.532-1.36 0-2.365-.354-3.134-1.004-.767-.71-1.122-1.654-1.122-2.836 0-1.36.532-2.363 1.656-3.13 1.123-.71 2.72-1.124 4.848-1.183l2.6-.06v-.885c0-1.3-.235-2.304-.767-2.954-.532-.65-1.36-1.005-2.543-1.005-1.24 0-2.6.355-3.96 1.064l-.474-1.064c1.478-.71 3.015-1.063 4.434-1.063 1.48 0 2.602.414 3.37 1.182.77.768 1.124 2.008 1.124 3.663v9.098h-.888v-.06zm-5.025-.886c1.478 0 2.602-.414 3.43-1.24.827-.828 1.24-2.01 1.24-3.487v-1.357l-2.364.12c-1.95.117-3.31.412-4.137.885-.827.532-1.24 1.3-1.24 2.363 0 .828.235 1.537.767 2.01.59.473 1.36.71 2.305.71zM89.456 15.12c0 1.24-.473 2.186-1.42 2.836-.945.65-2.246 1.004-3.96 1.004-1.834 0-3.312-.295-4.376-.827v-1.36c1.36.71 2.838 1.006 4.375 1.006 1.36 0 2.365-.24 3.075-.65.71-.475 1.064-1.066 1.064-1.775 0-.71-.295-1.24-.828-1.713-.532-.473-1.478-.945-2.78-1.36-1.358-.47-2.304-.944-2.896-1.3-.532-.353-.946-.767-1.24-1.18-.298-.472-.416-1.004-.416-1.652 0-1.006.414-1.833 1.3-2.424.89-.59 2.072-.886 3.61-.886 1.476 0 2.896.295 4.196.827l-.473 1.123c-1.36-.532-2.6-.827-3.725-.827-1.123 0-2.01.177-2.66.53-.65.356-1.006.887-1.006 1.537 0 .71.237 1.3.77 1.714.53.413 1.477.886 2.955 1.418 1.244.472 2.13.827 2.72 1.18.593.356 1.007.77 1.244 1.242.355.414.473.945.473 1.536zM18.03.24c.297 0 .593.236.593.59v25.583c0 .295-.237.59-.592.59-.293 0-.59-.236-.59-.59V.773c0-.298.296-.533.59-.533z"/>
                            </g>
                            <g fill="#3057FF">
                                <path
                                    d="M101.107 18.61l-.473-.947h-.06c-.295.414-.65.65-1.005.828-.356.12-.77.238-1.3.238-.653 0-1.185-.177-1.54-.59-.352-.416-.59-.948-.59-1.658 0-.768.237-1.3.77-1.654.53-.355 1.24-.59 2.245-.59l1.183-.06v-.116c0-.59-.296-.887-.828-.887s-1.182.178-1.95.532l-.71-1.595c.827-.414 1.832-.65 3.074-.65.887 0 1.596.236 2.07.65.472.413.71 1.063.71 1.83v4.55h-1.598v.12zm-1.774-1.538c.295 0 .532-.118.768-.296.18-.177.298-.413.298-.71v-.53h-.532c-.77 0-1.183.295-1.183.886-.06.413.178.65.65.65zM108.558 18.788c-.355 0-.65-.06-.946-.177-.296-.117-.532-.353-.828-.65h-.118c.06.474.118.77.118.888v2.777h-2.424v-9.927h1.95l.356.886h.118c.473-.65 1.064-1.004 1.833-1.004.77 0 1.36.295 1.833.945.414.65.65 1.536.65 2.66 0 1.12-.236 2.008-.71 2.658-.413.59-1.004.945-1.832.945zm-.77-5.376c-.353 0-.59.118-.767.354-.117.236-.235.65-.235 1.123v.175c0 .59.06 1.004.237 1.3.178.295.415.413.77.413.295 0 .53-.12.65-.414.118-.296.236-.71.236-1.3 0-.59-.06-1.005-.236-1.3-.178-.295-.355-.354-.65-.354zM112.46 9.923c0-.353.118-.65.296-.827.177-.176.532-.236.946-.236.414 0 .768.118 1.005.295.177.178.295.473.295.828 0 .71-.413 1.063-1.3 1.063-.828-.06-1.242-.414-1.242-1.123zm2.424 8.685h-2.424v-6.912h2.424v6.912z"/>
                            </g>
                        </svg>
                    </a>

                    <strong className="h-small light">General</strong>
                    <ul className="nav-menu">
                        <li><a className="nav-link" href="#intro">Introduction</a></li>
                        <li><a className="nav-link" href="#authentication">Authentication</a></li>
                        <li><a className="nav-link" href="#pagination">Pagination</a></li>
                        <li><a className="nav-link" href="#querying-the-api">Querying the API</a></li>
                        <li><a className="nav-link" href="#errors">Errors</a></li>
                    </ul>

                    <strong className="h-small light">Core resources</strong>
                    <ul className="nav-menu">
                        {
                            orderedResources.map(tag => (
                                <li key={tag.get('name')}>
                                    <a className="nav-link" href={`#${tag.get('name')}`}>
                                        {tag.get('name')}
                                    </a>
                                    {
                                        window.location.hash.includes(`${tag.get('name')}`) && (
                                            <ul className="nav-menu nested">
                                                <li>
                                                    <a className="nav-link" href={`#${tag.get('name')}-properties`}
                                                       title={`${tag.get('name')} object properties`}
                                                    >
                                                        {tag.get('name')} object
                                                    </a>
                                                </li>
                                                {
                                                    tag.get('subResources').map((sub) => (
                                                        <li key={sub.get('path') + sub.get('name')}>
                                                            <a href={`#${slug(`${sub.get('method')}-${sub.get('path')}`)}`}
                                                               title={sub.get('title')}
                                                            >
                                                                {sub.get('name')}
                                                            </a>
                                                        </li>
                                                    ))
                                                }
                                            </ul>
                                        )
                                    }
                                </li>
                            )).toList().toJS()
                        }
                    </ul>

                    <strong className="h-small light">All Objects</strong>
                    <ul className="nav-menu">
                        {
                            orderedDefinitions.map((def, name) => (
                                <li key={name}>
                                    <a href={`#${name}-definition`}>
                                        {name}
                                    </a>
                                </li>
                            )).toList().toJS()
                        }
                    </ul>
                </div>
            </div>
        </div>
    )
}

export default Navigation
